@model List<_52000657_LuuDucHai.Models.CartItem>

@{
    ViewBag.Title = "Đặt hàng";
    Layout = "~/Views/Shared/_MyLayout.cshtml";
}

@{ //hàm dùng để format integer dưới dạng currency
    string Currency(int? curr)
    {
        return String.Format("{0:#,#.}", curr) + "đ";
    }
}

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" class="flexbox">
<head>
    <link rel="shortcut icon" href="./theme.hstatic.net/1000177652/1000229231/14/favicon.png?v=90" type="image/png" />
    <link href='~/Content/css/checkouts.css?v=7' rel='stylesheet' type='text/css' media='all' />
    @*<link href='~/Content/css/checkouts.css?v=90' rel='stylesheet' type='text/css' media='all' />*@
    <script src='~/Scripts/js/jquery.min.js' type='text/javascript'></script>
    <script src='~/Scripts/js/jquery.validate.js' type='text/javascript'></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2, user-scalable=no">

    <script type="text/javascript">
        var toggleShowOrderSummary = false;
        $(document).ready(function () {
            var currentUrl = '';


            currentUrl = 'http://happylive.vn/checkouts/913189a78ff74efa816492a0bf2c7981?step=1';


            if ($('#reloadValue').val().length == 0) {
                $('#reloadValue').val(currentUrl);
                $('body').show();
            }
            else {
                window.location = $('#reloadValue').val();
                $('#reloadValue').val('');
            }

            $('body')
                .on('click', '.order-summary-toggle', function () {
                    toggleShowOrderSummary = !toggleShowOrderSummary;

                    if (toggleShowOrderSummary) {
                        $('.order-summary-toggle')
                            .removeClass('order-summary-toggle-hide')
                            .addClass('order-summary-toggle-show');

                        $('.sidebar:not(".sidebar-second") .sidebar-content .order-summary')
                            .removeClass('order-summary-is-collapsed')
                            .addClass('order-summary-is-expanded');

                        $('.sidebar.sidebar-second .sidebar-content .order-summary')
                            .removeClass('order-summary-is-expanded')
                            .addClass('order-summary-is-collapsed');
                    } else {
                        $('.order-summary-toggle')
                            .removeClass('order-summary-toggle-show')
                            .addClass('order-summary-toggle-hide');

                        $('.sidebar:not(".sidebar-second") .sidebar-content .order-summary')
                            .removeClass('order-summary-is-expanded')
                            .addClass('order-summary-is-collapsed');

                        $('.sidebar.sidebar-second .sidebar-content .order-summary')
                            .removeClass('order-summary-is-collapsed')
                            .addClass('order-summary-is-expanded');
                    }
                });
        });
    </script>

    <script>
        //<![CDATA[
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', './www.google-analytics.com/analytics.js', 'ga');
        ga('create', 'UA-97086989-1', 'auto');
        try {

        } catch (e) { };
        ga('send', 'pageview');

        //]]>
    </script>
    <script>
        //<![CDATA[
        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return; n = f.fbq = function () {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            }; if (!f._fbq) f._fbq = n;
            n.push = n; n.loaded = !0; n.version = '2.0'; n.queue = []; t = b.createElement(e); t.async = !0;
            t.src = v; s = b.getElementsByTagName(e)[0]; s.parentNode.insertBefore(t, s)
        }(window,
            document, 'script', './connect.facebook.net/en_US/fbevents.js');
        // Insert Your Facebook Pixel ID below.
        fbq('init', '905600829489553');
        fbq('track', 'PageView');
        //]]>
    </script>
    <noscript>
        <img height='1' width='1' style='display:none'
             src='https://www.facebook.com/tr?id=905600829489553&amp;ev=PageView&amp;noscript=1' />
    </noscript>
    <script type='text/javascript'>
        //<![CDATA[
        if ((typeof Haravan) === 'undefined') {
            Haravan = {};
        }
        Haravan.culture = 'vi-VN';
        Haravan.shop = 'happylive.myharavan.com';
        Haravan.theme = { "name": "Theme mặc định", "id": 1000229231, "role": "main" };
        Haravan.domain = 'happylive.vn';
//]]>
    </script>

</head>
<body>

    <input id="reloadValue" type="hidden" name="reloadValue" value="" />
    <div class="banner">
        <div class="wrap">
            <a href="http://happylive.vn" class="logo">
                <h1 class="logo-text">OxyWatch</h1>
            </a>
        </div>
    </div>
    <button class="order-summary-toggle order-summary-toggle-hide">
        <div class="wrap">
            <div class="order-summary-toggle-inner">
                <div class="order-summary-toggle-icon-wrapper">
                    <svg width="20" height="19" xmlns="http://www.w3.org/2000/svg" class="order-summary-toggle-icon"><path d="M17.178 13.088H5.453c-.454 0-.91-.364-.91-.818L3.727 1.818H0V0h4.544c.455 0 .91.364.91.818l.09 1.272h13.45c.274 0 .547.09.73.364.18.182.27.454.18.727l-1.817 9.18c-.09.455-.455.728-.91.728zM6.27 11.27h10.09l1.454-7.362H5.634l.637 7.362zm.092 7.715c1.004 0 1.818-.813 1.818-1.817s-.814-1.818-1.818-1.818-1.818.814-1.818 1.818.814 1.817 1.818 1.817zm9.18 0c1.004 0 1.817-.813 1.817-1.817s-.814-1.818-1.818-1.818-1.818.814-1.818 1.818.814 1.817 1.818 1.817z"></path></svg>
                </div>
                <div class="order-summary-toggle-text order-summary-toggle-text-show">
                    <span>Hiển thị thông tin đơn hàng</span>
                    <svg width="11" height="6" xmlns="http://www.w3.org/2000/svg" class="order-summary-toggle-dropdown" fill="#000"><path d="M.504 1.813l4.358 3.845.496.438.496-.438 4.642-4.096L9.504.438 4.862 4.534h.992L1.496.69.504 1.812z"></path></svg>
                </div>
                <div class="order-summary-toggle-text order-summary-toggle-text-hide">
                    <span>Ẩn thông tin đơn hàng</span>
                    <svg width="11" height="7" xmlns="http://www.w3.org/2000/svg" class="order-summary-toggle-dropdown" fill="#000"><path d="M6.138.876L5.642.438l-.496.438L.504 4.972l.992 1.124L6.138 2l-.496.436 3.862 3.408.992-1.122L6.138.876z"></path></svg>
                </div>
                <div class="order-summary-toggle-total-recap" data-checkout-payment-due-target="669300000">
                    <span class="total-recap-final-price">6,693,000₫</span>
                </div>
            </div>
        </div>
    </button>
    <div class="content content-second">
        <div class="wrap">
            <div class="sidebar sidebar-second">
                <div class="sidebar-content">
                    <div class="order-summary">
                        <div class="order-summary-sections">


                            <div class="order-summary-section order-summary-section-discount" data-order-summary-section="discount">
                                <form id="form_discount_add" accept-charset="UTF-8" method="post">
                                    <input name="utf8" type="hidden" value="✓">
                                    <div class="fieldset">
                                        <div class="field  ">
                                            <div class="field-input-btn-wrapper">
                                                <div class="field-input-wrapper">
                                                    <label class="field-label" for="discount.code">Mã giảm giá</label>
                                                    <input placeholder="Mã giảm giá" class="field-input" data-discount-field="true" autocomplete="off" autocapitalize="off" spellcheck="false" size="30" type="text" id="discount.code" name="discount.code" value="" />
                                                </div>
                                                <button type="submit" class="field-input-btn btn btn-default btn-disabled">
                                                    <span class="btn-content">Sử dụng</span>
                                                    <i class="btn-spinner icon icon-button-spinner"></i>
                                                </button>
                                            </div>

                                        </div>
                                    </div>
                                </form>
                            </div>


                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="content">

        <div class="wrap">
            <div class="sidebar">
                <div class="sidebar-content">
                    <div class="order-summary order-summary-is-collapsed">
                        <h2 class="visually-hidden">Thông tin đơn hàng</h2>
                        <div class="order-summary-sections">
                            <div class="order-summary-section order-summary-section-product-list" data-order-summary-section="line-items">
                                <table class="product-table">
                                    <thead>
                                        <tr>
                                            <th scope="col"><span class="visually-hidden">Hình ảnh</span></th>
                                            <th scope="col"><span class="visually-hidden">Mô tả</span></th>
                                            <th scope="col"><span class="visually-hidden">Số lượng</span></th>
                                            <th scope="col"><span class="visually-hidden">Giá</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{ var total = 0;}
                                        @foreach (var i in Model)
                                        {
                                            <tr class="product">
                                                @*data-product-id="1004862902" data-variant-id="1012030836"*@
                                                <td class="product-image">
                                                    <div class="product-thumbnail">
                                                        <div class="product-thumbnail-wrapper">
                                                            <img class="product-thumbnail-image" alt="@i.product.firstImg" src="~/Uploads/products/@i.product.firstImg" />
                                                        </div>
                                                        <span class="product-thumbnail-quantity" aria-hidden="true">@i.quantity</span>
                                                    </div>
                                                </td>
                                                <td class="product-description">
                                                    <span class="product-description-name order-summary-emphasis">@i.product.name</span>

                                                </td>
                                                <td class="product-quantity visually-hidden">@i.quantity</td>
                                                <td class="product-price">
                                                    @{
                                                        var amount = i.product.newPrice * i.quantity;
                                                        total += int.Parse(amount.ToString());
                                                    }
                                                    <span class="order-summary-emphasis">@Currency(@amount)</span>
                                                </td>
                                            </tr>
                                        }

                                    </tbody>
                                </table>
                            </div>

                            <div class="order-summary-section order-summary-section-discount" data-order-summary-section="discount">
                                <form id="form_discount_add" accept-charset="UTF-8" method="post">
                                    <input name="utf8" type="hidden" value="✓">
                                    <div class="fieldset">
                                        <div class="field  ">
                                            <div class="field-input-btn-wrapper">
                                                <div class="field-input-wrapper">
                                                    <label class="field-label" for="discount.code">Mã giảm giá</label>
                                                    <input placeholder="Mã giảm giá" class="field-input" data-discount-field="true" autocomplete="off" autocapitalize="off" spellcheck="false" size="30" type="text" id="discount.code" name="discount.code" value="" />
                                                </div>
                                                <button type="submit" class="field-input-btn btn btn-default btn-disabled">
                                                    <span class="btn-content">Sử dụng</span>
                                                    <i class="btn-spinner icon icon-button-spinner"></i>
                                                </button>
                                            </div>

                                        </div>
                                    </div>
                                </form>
                            </div>

                            <div class="order-summary-section order-summary-section-total-lines" data-order-summary-section="payment-lines">
                                <table class="total-line-table">
                                    <thead>
                                        <tr>
                                            <th scope="col"><span class="visually-hidden">Mô tả</span></th>
                                            <th scope="col"><span class="visually-hidden">Giá</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="total-line total-line-subtotal">
                                            <td class="total-line-name">Tạm tính</td>
                                            <td class="total-line-price">
                                                <span class="order-summary-emphasis" data-checkout-subtotal-price-target="669300000">
                                                    @Currency(total)
                                                </span>
                                            </td>
                                        </tr>

                                        <tr class="total-line total-line-shipping">
                                            <td class="total-line-name">Phí vận chuyển</td>
                                            <td class="total-line-price">
                                                <span class="order-summary-emphasis" data-checkout-total-shipping-target="0">

                                                    Miễn phí

                                                </span>
                                            </td>
                                        </tr>
                                    </tbody>
                                    <tfoot class="total-line-table-footer">
                                        <tr class="total-line">
                                            <td class="total-line-name payment-due-label">
                                                <span class="payment-due-label-total">Tổng cộng</span>
                                            </td>
                                            <td class="total-line-name payment-due">
                                                <span class="payment-due-currency">VND</span>
                                                <span class="payment-due-price" data-checkout-payment-due-target="669300000">
                                                    @Currency(total)
                                                </span>
                                            </td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="main">
                <div class="main-header">
                    <a href="http://happylive.vn" class="logo">
                        <h1 class="logo-text">OxyWatch</h1>
                    </a>

                    <ul class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="gio-hang">Giỏ hàng</a>
                        </li>

                        <li class="breadcrumb-item breadcrumb-item-current">

                            Thông tin giao hàng

                        </li>
                        <li class="breadcrumb-item ">

                            Phương thức thanh toán

                        </li>

                    </ul>

                </div>
                <div class="main-content">

                    <div class="step">
                        <div class="step-sections " step="1">


                            <div class="section">
                                <div class="section-header">
                                    <h2 class="section-title">Thông tin giao hàng</h2>
                                </div>
                                <div class="section-content section-customer-information no-mb">

                                    <input name="utf8" type="hidden" value="✓">
                                    <div class="inventory_location_data">

                                        <input name="customer_shipping_district" type="hidden" value="" />
                                        <input name="customer_shipping_ward" type="hidden" value="" />

                                    </div>


                                    @*<p class="section-content-text">
                                        Bạn đã có tài khoản?
                                        <a href="http://happylive.vn/account/login?urlredirect=http%3a%2f%2fhappylive.vn%2fcheckouts%2f913189a78ff74efa816492a0bf2c7981%3fstep%3d1">Đăng nhập</a>
                                    </p>*@


                                    <div class="fieldset">


                                        <div class="field">
                                            <div class="field-input-wrapper">
                                                <label class="field-label" for="fullName">Họ và tên</label>
                                                <input form="form_next_step" placeholder="Họ và tên" autocapitalize="off" spellcheck="false" class="field-input" size="30" type="text" id="fullName" name="fullName" value="" />
                                            </div>

                                        </div>



                                        <div class="field  field-two-thirds  ">
                                            <div class="field-input-wrapper">
                                                <label class="field-label" for="email">Email</label>
                                                <input form="form_next_step" placeholder="Email" autocapitalize="off" spellcheck="false" class="field-input" size="30" type="email" id="email" name="email" value="" />
                                            </div>

                                        </div>



                                        <div class="field field-required field-third  ">
                                            <div class="field-input-wrapper">
                                                <label class="field-label" for="phone">Số điện thoại</label>
                                                <input form="form_next_step" placeholder="Số điện thoại" autocapitalize="off" spellcheck="false" class="field-input" size="30" maxlength="11" type="tel" id="phone" name="phone" value="" />
                                            </div>

                                        </div>


                                        <div class="field   ">
                                            <div class="field-input-wrapper">
                                                <label class="field-label" for="address">Địa chỉ</label>
                                                <input form="form_next_step" placeholder="Địa chỉ (đường, phường, xã)" autocapitalize="off" spellcheck="false" class="field-input" size="30" type="text" id="address" name="address" value="" />
                                            </div>

                                        </div>

                                    </div>
                                </div>
                                <div class="section-content">
                                    <div class="fieldset">

                                        <form id="form_update_location" class="clearfix" accept-charset="UTF-8" method="post">
                                            <input name="utf8" type="hidden" value="✓">
                                            <div class="field  field-half  ">
                                                <div class="field-input-wrapper field-input-wrapper-select">
                                                    <label class="field-label" for="locationProvince">Tỉnh / thành</label>
                                                    <select class="field-input" id="locationProvince" name="locationProvince" form="form_next_step">
                                                        <option value="" selected>Chọn tỉnh / thành</option>
                                                    </select>
                                                </div>

                                            </div>

                                            <div class="field  field-half  ">
                                                <div class="field-input-wrapper field-input-wrapper-select">
                                                    <label class="field-label" for="locationDistrict">Quận / huyện</label>
                                                    <select class="field-input" id="locationDistrict" name="locationDistrict" form="form_next_step">
                                                        <option value="" selected>Chọn quận / huyện</option>
                                                    </select>
                                                </div>

                                            </div>


                                        </form>

                                    </div>
                                </div>
                                <div id="change_pick_location_or_shipping">


                                </div>
                            </div>


                        </div>
                        <div class="step-footer">


                            <form id="form_next_step" accept-charset="UTF-8" method="post">
                                <input name="utf8" type="hidden" value="✓">
                                <button type="submit" class="step-footer-continue-btn btn">
                                    <span class="btn-content">Tiếp tục đến phương thức thanh toán</span>
                                    <i class="btn-spinner icon icon-button-spinner"></i>
                                </button>
                            </form>
                            <a class="step-footer-previous-link" href="gio-hang">
                                <svg class="previous-link-icon icon-chevron icon" xmlns="http://www.w3.org/2000/svg" width="6.7" height="11.3" viewBox="0 0 6.7 11.3"><path d="M6.7 1.1l-1-1.1-4.6 4.6-1.1 1.1 1.1 1 4.6 4.6 1-1-4.6-4.6z"></path></svg>
                                Giỏ hàng
                            </a>


                        </div>
                    </div>

                </div>
                <div class="main-footer">

                </div>
            </div>
        </div>

    </div>

</body>
</html>


<script>
    var lst

    function compare(a, b) {
        let characters = ['A', 'Ă', 'Â', 'B', 'C', 'D', 'Đ', 'E', 'Ê', 'G', 'H', 'I', 'K', 'L', 'M', 'N', 'O', 'Ô', 'Ơ', 'P', 'Q', 'R', 'S', 'T', 'U', 'Ư', 'V', 'X', 'Y']

        let indexA = characters.indexOf(a.name.charAt(0).toUpperCase())
        let indexB = characters.indexOf(b.name.charAt(0).toUpperCase())

        if (indexA < indexB) {
            return -1
        }
        else if (indexA < indexB)
            return 1
        else {
            return a.name < b.name ? -1 : 1
        }
    }

    $.ajax({
        url: 'https://provinces.open-api.vn/api/?depth=2',
        method: 'GET'
    })
        .done(function (res) {
            lst = res  //Danh sách 

            //Loại bỏ từ 'tỉnh/thành' khỏi tên
            for (let i = 0; i < lst.length; i++) {
                lst[i].name = lst[i].name.replace('Tỉnh', '')
                lst[i].name = lst[i].name.replace('Thành phố', '')
                lst[i].name = lst[i].name.trim()

                lst[i].districts.sort(compare)
            }

            lst.sort(compare)
            //console.log(lst)

            let selectProvince = document.getElementById('locationProvince')
            //Đưa dữ liệu vào thẻ select
            for (let i = 0; i < lst.length; i++) {
                let option = document.createElement('option')
                option.value = lst[i].name
                option.innerText = lst[i].name
                selectProvince.appendChild(option)    
            }
        })
        .fail(function (err) {
            alert('Lỗi khi load api tỉnh thành: ' + err)
        })


    ////If user selected a city (province) then load data about district with that city
    document.getElementById('locationProvince').addEventListener('change', function (e) {
        let codeProvince = e.target.value
        let selectProvince = document.getElementById('locationDistrict')

        //Remove old data district if it exists
        if ($('#locationDistrict').children().length != 0) {
            $('#locationDistrict').empty()
        }

        let index = -1
        //Load data into select tag district
        for (let i = 0; i < lst.length; i++) {
            if (codeProvince == lst[i].name) {
                index = i
                break
            }
        }   
        
        let districts = lst[index].districts
        //console.log(districts)
        for (let i = 0; i < districts.length; i++) {
            let option = document.createElement('option')
            option.value = districts[i].name
            option.innerText = districts[i].name
            selectProvince.appendChild(option)
        }
    })
</script>



